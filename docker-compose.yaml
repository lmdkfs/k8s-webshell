version: "3"
services:
  go-build:
    image: golang:1.12-alpine 
    environment:
      - GOBIN=/go/bin
      - GOOS=linux
      - GOARCH=amd64

    volumes:
      - ./cmd:/go/src/k8s-webshell/cmd
      - ./configs:/go/src/k8s-webshell/configs
      - ./configs/privkey.pem:/go/src/k8s-webshell/configs/privkey.pem
      - ./configs/fullchain.pem:/go/src/k8s-webshell/configs/fullchain.pem
      - ./pkg:/go/src/k8s-webshell/pkg
      - ./middleware:/go/src/k8s-webshell/middleware
      - ./routers:/go/src/k8s-webshell/routers
      - ./vendor:/go/src/k8s-webshell/vendor
      - ./bin:/go/bin
    command: ["go", "install", "-v", "/go/src/k8s-webshell/cmd/k8s-webshell.go"]

  k8s-webshell:
    build: 
      context: .
      #dockerfile: Dockerfile
    image: harbor.renmaitech.cn/galaxy/k8s-webshell:v1.2
    ports:
      - "30001:7777"
    environment:
      - WEBSHELL_SERVER_RUN_MODE=debug
      - WEBSHELL_SERVER_LOGPATH=/var/logs
      - WEBSHELL_SERVER_LOGNAME=webshell.log
      - WEBSHELL_SERVER_PORT=7777
      - WEBSHELL_SERVER_KUBECONFIG=/data/admin.conf
      - WEBSHELL_SERVER_INCLUSTER=false
      - WEBSHELL_SERVER_JWT_SECRET=Youguess
      - WEBSHELL_SERVER_SECRET_KEY=ERkyNK2Q
      - WEBSHELL_SERVER_SSL_CERTIFICATE=/data/privkey.pem
      - WEBSHELL_SERVER_SSL_CERTIFICATE_KEY=/data/fullchain.pem
    volumes:
      - ./configs/admin.conf:/data/admin.conf
    command: ["./k8s-webshell"]    



            

        
      
              
